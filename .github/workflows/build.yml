name: Build Arm64 (Hack Sign)
on: [workflow_dispatch] # 手动触发

jobs:
  build:
    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./simple_live_app # 全局指定在 simple_live_app 目录下运行

    steps:
    - uses: actions/checkout@v4

    - uses: actions/setup-java@v4
      with:
        distribution: 'zulu'
        java-version: '17'

    - uses: subosito/flutter-action@v2
      with:
        channel: 'stable'

    - name: Hack Signing Config & Build
      run: |
        # 【关键修正】路径改为 app/build.gradle，因为工作目录是 simple_live_app
        sed -i 's/signingConfig signingConfigs.release/signingConfig signingConfigs.debug/g' android/app/build.gradle

        flutter pub get
        flutter build apk --release --target-platform android-arm64

    - uses: actions/upload-artifact@v4
      with:
        name: simple-live-arm64-hacked
        path: simple_live_app/build/app/outputs/flutter-apk/app-release.apk
